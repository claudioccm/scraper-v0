# Component: `ccm-card`

**Source:** This specification is based on the principles outlined in Heydon Pickering's ["Inclusive Components: Cards"](https://inclusive-components.design/cards/).

## 1. Core Philosophy

The `ccm-card` component should be a robust, accessible, and progressively enhanced teaser for linked content (like a blog post or case study). It must prioritize a logical document structure for assistive technologies while providing an intuitive, clickable interface for all users.

## 2. Props

The component should accept the following props:

**Content Props:**
- `href` (String, required): The URL for the card's primary link.
- `title` (String, required): The main title for the card, which will also serve as the primary link text.
- `description` (String, optional): A brief summary or description.
- `imageUrl` (String, optional): The URL for the card's image.
- `imageAlt` (String, required if `imageUrl` is present): The alt text for the image. If the image is purely decorative, this should be an empty string (`""`).
- `meta` (String, optional): Small metadata text, like an author's name or date.
- `showCta` (Boolean, default: `false`): If `true`, displays a "Read More" visual cue.

**Design Props:**
- `variant` (String, default: `"default"`): Visual style variant (`default`, `elevated`, `outlined`, `filled`)
- `color` (String, default: `"base"`): Color theme (`base`, `primary`, `secondary`, `accent`)
- `size` (String, default: `"m"`): Size variant (`s`, `m`, `l`)
- `layout` (String, default: `"vertical"`): Layout orientation (`vertical`, `horizontal`)

## 3. Markup Specification (HTML Structure)

The component must render the following semantic structure. The root element **must** be a `<li>`.

### 3.1. Source Order

The DOM order is critical for accessibility. Elements must be ordered as follows, even if their visual presentation is different:

1.  **Text Content Wrapper** (`div`):
    1.  **Title/Heading** (`h2` or other appropriate heading level):
        - Contains the primary `<a>` tag.
        - The `href` attribute of the `<a>` tag is bound to the `href` prop.
        - The text content is the `title` prop.
        - If `showCta` is `true`, this `<a>` tag must have an `aria-describedby` attribute pointing to the ID of the CTA `span`.
    2.  **Description** (`p`):
        - Contains the `description` prop content.
    3.  **CTA** (`span`):
        - Rendered only if `showCta` is `true`.
        - Must have a unique `id` for the `aria-describedby` relationship. This ID can be generated by slugifying the title.
        - Must have `aria-hidden="true"` to prevent screen readers from announcing it as a separate, non-interactive element.
        - Text content should be "Read More" or similar.
    4.  **Meta** (`small` or `p`):
        - Contains the `meta` prop content.
2.  **Image Wrapper** (`div`):
    1.  **Image** (`img`):
        - `src` is bound to `imageUrl`.
        - `alt` is bound to `imageAlt`.

### 3.2. Example Structure

```html
<li class="ccm-card">
  <!-- Text content must come first in the DOM -->
  <div class="ccm-card__text">
    <h2 class="ccm-card__title">
      <a href="/path-to-post" class="ccm-card__link" aria-describedby="cta-card-design-woes">
        Card design woes
      </a>
    </h2>
    <p class="ccm-card__description">Ten common pitfalls to avoid when designing card components.</p>
    <span class="ccm-card__cta" aria-hidden="true" id="cta-card-design-woes">Read more</span>
    <small class="ccm-card__meta">By Heydon Pickering</small>
  </div>

  <!-- Image comes after text in the DOM -->
  <div class="ccm-card__image">
    <img src="/path/to/image.png" alt="A decorative illustration." class="ccm-card__img">
  </div>
</li>
```

**CSS Class Structure:**
- `.ccm-card` - Root component following project naming convention
- `.ccm-card__text` - BEM modifier for text content wrapper
- `.ccm-card__title` - Title/heading element
- `.ccm-card__link` - Primary link element
- `.ccm-card__description` - Description paragraph
- `.ccm-card__cta` - Call-to-action element
- `.ccm-card__meta` - Metadata element
- `.ccm-card__image` - Image wrapper
- `.ccm-card__img` - Image element

## 4. Behavior and Interactivity

### 4.1. Clickability

The entire card should be clickable, not just the title link. This provides a larger, more user-friendly target area.

- A click event listener must be attached to the root `<li>` element.
- This event handler should programmatically trigger a `click()` on the primary `<a>` tag inside the `<h2>`.
- The handler must check that the event target is not the primary link itself to avoid a double-firing event loop due to event bubbling.
- To allow for text selection, the handler should detect the time between `mousedown` and `mouseup`. If the duration exceeds a threshold (e.g., 200ms), the click action should be suppressed.

### 4.2. Example Script (Vue 3 Composition API)

```javascript
<script setup>
import { ref, onMounted } from 'vue';

// Props following project patterns
const props = defineProps({
  // Content props
  href: {
    type: String,
    required: true
  },
  title: {
    type: String,
    required: true
  },
  description: {
    type: String,
    default: ''
  },
  imageUrl: {
    type: String,
    default: ''
  },
  imageAlt: {
    type: String,
    default: ''
  },
  meta: {
    type: String,
    default: ''
  },
  showCta: {
    type: Boolean,
    default: false
  },
  // Design props
  variant: {
    type: String,
    default: 'default',
    validator: (value) => ['default', 'elevated', 'outlined', 'filled'].includes(value)
  },
  color: {
    type: String,
    default: 'base',
    validator: (value) => ['base', 'primary', 'secondary', 'accent'].includes(value)
  },
  size: {
    type: String,
    default: 'm',
    validator: (value) => ['s', 'm', 'l'].includes(value)
  },
  layout: {
    type: String,
    default: 'vertical',
    validator: (value) => ['vertical', 'horizontal'].includes(value)
  }
});

// Template refs
const cardElement = ref(null);
const primaryLink = ref(null);
let down, up;

// Generate unique ID for CTA aria-describedby
const ctaId = computed(() => {
  if (props.showCta && props.title) {
    return `cta-${props.title.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '')}`;
  }
  return null;
});

// Click handling for card interactivity
onMounted(() => {
  if (cardElement.value) {
    primaryLink.value = cardElement.value.querySelector('.ccm-card__link');

    cardElement.value.onmousedown = () => {
      down = +new Date();
    };

    cardElement.value.onmouseup = (e) => {
      up = +new Date();
      if ((up - down) < 200) {
        if (primaryLink.value && e.target !== primaryLink.value) {
          primaryLink.value.click();
        }
      }
    };
  }
});
</script>
```

## 5. Design Variants and Tokens

### 5.1. Design Token Architecture

Following the project's button component pattern, the card uses CSS custom properties with `v-bind()` for dynamic theming:

```css
.ccm-card {
  /* Core design tokens */
  --_card-color-prop: v-bind(color);
  --_card-variant-prop: v-bind(variant);
  --_card-size-prop: v-bind(size);
  
  /* Color system (following button pattern) */
  --_card-hsl: var(--_card-color-prop, var(--base-hsl));
  --_card-color: hsl(var(--_card-hsl));
  --_card-background-color: transparent;
  --_card-border-color: var(--_card-color);
  
  /* Border design tokens */
  --_card-border-width: var(--base-border-width, 1px);
  --_card-border-style: var(--base-border-style, solid);
  
  /* Radius design tokens */
  --_card-border-radius: var(--border-radius-m);
  
  /* Spacing tokens */
  --_card-padding-block: var(--space-m);
  --_card-padding-inline: var(--space-m);
  --_card-gap: var(--space-s);
}
```

### 5.2. Color Variants

Color variants leverage the existing HSL color system:

```css
.ccm-card[color="base"] { --_card-hsl: var(--base-hsl); }
.ccm-card[color="primary"] { --_card-hsl: var(--primary-hsl); }
.ccm-card[color="secondary"] { --_card-hsl: var(--secondary-hsl); }
.ccm-card[color="accent"] { --_card-hsl: var(--accent-hsl); }
```

### 5.3. Visual Variants

Visual variants affect border, background, and shadow properties:

```css
.ccm-card[variant="default"] {
  --_card-border-width: 1px;
  --_card-background-color: var(--base-color-02-tint);
  --_card-border-color: var(--base-color-10-tint);
}

.ccm-card[variant="elevated"] {
  --_card-border-width: 0;
  --_card-background-color: var(--white-color);
  box-shadow: var(--box-shadow-m);
}

.ccm-card[variant="outlined"] {
  --_card-border-width: 2px;
  --_card-background-color: transparent;
  --_card-border-color: hsl(var(--_card-hsl));
}

.ccm-card[variant="filled"] {
  --_card-border-width: 0;
  --_card-background-color: var(--base-color-05-alpha);
  --_card-border-color: hsl(var(--_card-hsl));
}
```

### 5.4. Size Variants

Size variants systematically scale padding, radius, and spacing:

```css
.ccm-card[size="s"] {
  --_card-padding-block: var(--space-s);
  --_card-padding-inline: var(--space-s);
  --_card-border-radius: var(--border-radius-s);
  --_card-gap: var(--space-xs);
}

.ccm-card[size="l"] {
  --_card-padding-block: var(--space-l);
  --_card-padding-inline: var(--space-l);
  --_card-border-radius: var(--border-radius-l);
  --_card-gap: var(--space-m);
}
```

### 5.5. Design Token Reference

**Border Width Tokens:**
- `1px` - Subtle outline (default)
- `2px` - Emphasized border (outlined variant)
- `0` - No border (elevated, filled variants)

**Border Radius Tokens:**
- `--border-radius-s` (4px) - Small cards, compact layouts
- `--border-radius-m` (8px) - Default cards
- `--border-radius-l` (12px) - Large feature cards

**Color Integration:**
- Leverages existing HSL color system with tints/shades/alpha variations
- `--base-color-02-tint`, `--base-color-10-tint` for subtle backgrounds/borders
- `--base-color-05-alpha` for filled variant transparency

## 6. Styling (CSS)

### 6.1. CSS Architecture Integration

This component must integrate with the existing CSS architecture:

- **CSS Layers**: The component styles should be added to the `components` layer
- **CSS Variables**: Use existing design tokens from the project's variable system
- **Spacing**: Use the project's fluid spacing system (e.g., `var(--space-s)`, `var(--space-m)`, `var(--space-l)`)
- **Colors**: Leverage the existing color system with HSL values and tint/shade utilities

### 6.2. Available Design Tokens

**Spacing Variables (from space.css):**
- `--space-3xs` through `--space-3xl` for consistent spacing
- `--space-s-m`, `--space-m-l` for fluid spacing pairs
- Use spacing utilities: `.padding-block:s`, `.margin-inline:auto`, etc.

**Color Variables (from colors.css):**
- Base colors: `--base-color`, `--primary-color`, `--secondary-color`, `--accent-color`
- Tints: `--base-color-10-tint`, `--base-color-20-tint`, etc.
- Alpha variations: `--base-color-10-alpha`, `--base-color-20-alpha`, etc.

**Layout Utilities (from everylayout.css):**
- `.stack` for vertical rhythm
- `.cluster` for horizontal grouping
- `.center` for content centering

**Effects and Borders:**
- `--border-radius-s`, `--border-radius-m`, `--border-radius-l`
- `--box-shadow-s`, `--box-shadow-m`, `--box-shadow-l`
- `--base-separator` for consistent borders

### 6.3. Visual Order vs. Source Order

- The card container (`<li>`) should use `display: flex` and `flex-direction: column`
- The text content wrapper should have `order: 1` to appear visually after the image
- The image wrapper should have `order: 0` to appear at the top
- This separates visual presentation from accessible DOM order

### 6.4. Focus States

- Use existing focus utilities and variables from the design system
- When the primary link is focused, apply consistent focus indicators
- If `showCta` is `true`, use `:focus-within` on the card wrapper

### 6.5. Touch Targets

- Use the project's spacing variables for adequate touch targets
- Apply `var(--space-s)` minimum for interactive padding
- Ensure links have sufficient `padding-inline` and `padding-block`

## 7. Accessibility (A11y) Recap

- **Landmarks**: Cards must be grouped within a `<ul>` or `<ol>`
- **Headings**: The card title must be a heading (`<h2>`, `<h3>`, etc.) to facilitate navigation for screen reader users
- **Link Text**: Link text is descriptive and unique (e.g., the post title), not generic ("Read more")
- **Images**: `alt` text is mandatory. Use `""` for decorative images
- **ARIA**: `aria-hidden` and `aria-describedby` are used correctly to create a seamless experience for the optional CTA, avoiding redundant tab stops and providing clear context
- **Source Order**: The logical content order is preserved in the DOM, with visual changes handled by CSS
- **Focus Management**: Use project's existing focus indicators and ensure consistent focus behavior

## 8. Implementation Notes

### 8.1. Component File Location
- Place in `/components/ccmCard.vue` following project naming convention
- Component will be auto-imported due to Nuxt 3 configuration

### 8.2. CSS File Organization
- Add component styles to `/public/css/components/ccm-card.css`
- Import in main styles.css: `@import "components/ccm-card.css" layer(components);`
- Follow existing CSS layer methodology

### 8.3. Vue 3 Integration
- Use Composition API consistently with project patterns
- Follow existing prop definition patterns from other ccm components
- Implement template refs and event handling as shown in example

### 8.4. Design Token Usage
- Leverage existing spacing variables for consistent padding/margins
- Use color system variables for theming capabilities
- Apply existing border-radius and box-shadow tokens
- Utilize utility classes where appropriate (`.cluster`, `.stack`, spacing utilities)

### 8.5. Testing Considerations
- Ensure component works within existing `<ul>` contexts
- Test with various content lengths and image sizes
- Validate accessibility with screen readers
- Test click/touch interaction across devices
- Verify focus states and keyboard navigation
